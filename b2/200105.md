硬盘分区和文件系统散记
====
file命令的-s选项可以查看块设备的特性，比如`file -s /dev/sda`能看到这块盘是GRUB启动程序，接着又是若干个分区。而直接`file -s /dev/sda1`就只显示分区信息，可见/dev/下面分开显示sda和sda1并不是无意义的。lsblk和hdparm也是常用的查看硬盘的命令。

安卓有`protect_f`和`protect_s`分区，s是f的备份，专门用来保存SIM ME LOCK数据，运营商专用机就是修改这份数据达到的。原来是保存在/data分区，为保证恢复出厂时不用重新生成，干脆做成独立分区。

磁盘写入有两种模式

* write through: 直写式，数据不做校验直接写入磁盘，写完后再读出来后写校验值。性能差，可靠性高？
* write back: 写回式，数据先写到cache，再用cache计算校验值，然后数据和校验一起定入磁盘，如果cache足够大且性能强，可以一直写入。有些RAID卡要开启这种模式，除了有cache，还要有电池，保证掉电后cache数据也能写入磁盘。

文件系统单个分区上限取决于单个簇大小和簇个数，比如ext3的簇个数是uint32，取常见的簇大小4K来算，分区上限就是16TB。（似乎ext3簇大小不可改，NTFS可以改成单簇64K使上限达到256T）

ZFS的默认簇是128K，在和PG数据库配合时，其默认记录大小是8K，如果数据库用于零散查询较多的场景，最好用`zfs set recordsize=8k zp1/data`也调整到8K效率更高。