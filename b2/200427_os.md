# Linux内核与PAM模块简记

前因是容器中启动nfsd需要依赖内核加载ko模块，分读写记一下。

lsmod命令，或查看/proc/modules看到内核当前加载的ko模块。

/lib/modules/{ver}-{arch}/kernel 这里放的是所有可以加载的内核模块，以4.19为例，共有3559个，但初始启动加载的只有58个。ko文件之间有依赖关系，通过modinfo查看，查看原理也是从上述提到的内核路径中查找。

所有的ko操作命令有6个，都是/bin/kmod的别名。

PAM模块
--
类Unix系统的一套授权管理机制，Pluggable Authentication Modules，由SUN在1995年10月提出，并由ReaHat在1996年8月首次实现。典型的效果比如接ssh失败过多时，PAM会禁止登陆，ssh自身并不提供这种机制。

`pam_tally`基于用户的计数，当次数达到则触发规则，同时还配有`pam_tally2`应用程序查看和清空次数，不过在1.5版本的pam去掉了这个程序并引入`faillock`替代。

Linux将PAM分为4个阶段

1. 用户模块，检查目标用户是否符合规则，比如用户是否过期，是否有权访问某个服务等
2. 认证模块，检查用户认证方式，也可以和keyring交互
3. 密码模块，确保密码符合规则，保证密码强度
4. 会话模块，确定此会话的边界和属性

业界一直对pam不支持远程操作有争议，因为这导致了kerberos不兼容，后来又发展出SASL规范。