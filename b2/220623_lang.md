# scheme模块之s7实现

s7是对tinyscheme做了极大的丰富，并且持续演进。宏和模块机制借鉴CL，记录一下使用过程。

编译
--
虽说核心只有.h和.c各一个，但选项很多，又没有提供Makefile，还是要仔细看文档才行。默认把s7.c和repl.c编译成standalone的方式，虽然在安卓上能编译出二进制文件，但运行时要新编译libc的扩展，会遇到诸如没有wordexp.h头文件，没有网络库等。只能加上`DWITH_MAIN`选项编译s7.c得到standalone文件。还有如果遇到复数函数链接报错，还要在编译时加上`DHAVE_COMPLEX_NUMBERS=0`手动关闭。

模块
--
特殊变量`*features*`能看到当前加载的所有模块列表，但是可笑的是这个列表可以通过provide随意往里添加。虽然正常都是require然后找到那个文件，由该文件的首行实现provide。总觉得这种方式过于老式且似乎不能防止恶意行为。provide行为和lua的module很像，想来当时也是抄的吧，不过lua自己仅使用了一个版本就弃用，是不是也说明了什么。

自带库
--
大量使用了宏和C语言FFI，复杂不易懂。

使用
--
至今没想出scheme在CURD领域有什么用，字符串能力孱弱到只能取子串和拼接，完全无法用于web开发。