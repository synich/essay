# CDN的来源与应用

万维网自1990年推出以来，已从简单的客户端服务器模型演变为复杂的分布式体系结构，在演化过程中，CDN是其中很重要的基础设施。最早的CDN公司Akamai诞生于1998年，虽然经历了二十多年的发展，但是至今没有形成完整的范，各家的具体实现也不一样。CDN的核心点有两个，一个是缓存，一个是回源。

* 缓存：就是把资源复制一份到CDN服务器上的过程，缓存的管理需要协议，主要有ICP、HTCP、CARP。
* 回源：当CDN发现自己没有这个资源（一般是缓存的数据过期了），转头向根服务器（或者它的上层服务器）去要这个资源的过程。

## CDN协议

ICP(internet cache protocol)：最初的缓存控制协议，参考RFC2186。基于UDP协议实现的轻量级的缓存内部通信协议，被用于在Cache服务器之间相互查询web资源信息，以确定当前被请求的资源是否在其他服务器上。一个缓存服务器发送ICP请求给它的邻居，邻居会用ICP消息响应，如果有的话就是HIT无就是MISS。

HTCP(hypertext caching protocol)：RFC2756，管理一组http cache服务器并监控相关的缓存活动。该协议机制与ICP类似，都是通过向邻居服务器发送查询请求并获得应答来反映web对象在集群中的缓存情况。但设计ICP协议时考虑的是HTTP/0.9协议，查询资源是否存在时只允许缓存发送URL。HTTP版本1.0和1.1引入了很多新的请求首部，这些首部可以和URL一起用来确定文件是否匹配。只在请求中发送URL可能无法得到精确的响应，而HTCP允许兄弟缓存之间通过URL和所有的请求及响应首部来相互查询文档是否存在，以降低错误命中的可能。另外HTCP还允许兄弟缓存监视或请求在对方的缓存中添加或删除所选中的文档，并修改对方已缓存文档的缓存策略。

CARP(cache array routinig protocol)：CARP是ICP的一个替代品，通过建立HASH函数用于划分cache服务器集群的URL空间，通过HASH算法将用户对URL的请求准确路由到服务器阵列中的任一成员上，消除了阵列中重复缓存数据，实现了对cache资源的高效定位。CARP和ICP都允许管理者通过使用多个代理服务器来提高性能。优势：

1. 无需资源查询和应答的过程，降低网络传输开销
2. 消除了重复缓存数据，每份url保存一份，节约空间
3. 具有更好的扩展性，可以灵活的增删服务器节点

额外说一句，CARP也是共享地址冗余协议的缩写（Common Address Redundancy Protocol），是一种能让多台网上主机共享同一个IP地址的协议。它的设计目标在于为故障移转（failover）提供冗余的主机作为备援。
