处理权限校验问题的反思
====
公司产品的权限校验问题做了半年，前期我没有参与，最近因为人员调整所以换我来继续处理。说实话对于嵌入式产品却有多达6、70种权限的历史遗留问题，我很不认同。我觉得Onvif的权限模型把用户固定地划分到3个组，同时定义了几个固定的权限等级，语义清晰且一致性也很好。

经过上半年的处理，总算把6、70种权限归约到15种权限，结果产品又开始不停地提增加权限需求，我本来想限制权限种类不允许扩充，想想这样做在理论上站不住脚，还是要思考权限问题真正重要的根本约束(出发点)是什么，以及要达成的归约状态又是什么。

约束点就是每次的请求都需要权限校验。但是仅仅这样，就又会发散成不同产品各自定义权限，导致同一个请求却有五花八门的权限定义。甚至更加粗暴直接的是把权限和Web界面绑定。于是就出现今天开发提交给我的，增加一种日程这个请求的权限甚至包括了存储权限和编码权限，原因就是产品的惯性思维，因为录像和动检界面可以增加日程，所以增加日程的权限也要涵盖存储和编码。这类错误根本不值得讨论。

不同的嵌入式产品最终归约到统一客户端来展现，为了达成操作的最终的一致性，有必要限制权限和请求的关系。权限涉及安全产品线、产品线、协议模块和客户端，各自有各自的诉求，初步设想的处理基调是这样。

1. 原则上每种请求都要有权限，但如果是非敏感信息的只读操作，可以不校验权限，需要知会到安全产品线。
2. 协议模块对每种请求默认只提供一种预先定义的权限，且这种权限就是展示在客户端上的权限定义。多种权限增加使用认知难度，在处理上歧义也很多。
3. 如果产品线不认同这种权限，可以定制请求的权限列表，配合产品的Web界面，可以满足产品需求，不过这样的产品在接入统一客户端时还是会显示异常，终究无法做到全面的平衡。