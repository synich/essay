# HTTP协议历史与细节

## 来源

Lee在1980年时，便在CERN构建ENQUIRE系统，构建这个系统的经历，促使他在1989年3月开发了HTTP最早的版本0.9，当时还只是Lee在CERN的试验产品，直到1997年才发布了如今使用最广的1.1版本。巧合的是CGI版本也在同年正式归档RFC并发布1.1版（CGI起草于1993年，由于其目的就是解决HTTP的动态能力不足，当然晚于HTTP）。

和WWW万维网有一定相似性的Gopher协议诞生于1991年，可以说和HTTP的历史相当，技术上两者区别很大：Gopher使用分层结构，而HTTP则使用链接系统。

HTTP协议诞生时，也有其它协议，比如邮件、FTP、新闻组等协议，但这些协议都无法承载链接系统，因此Lee最终决定开发新的HTTP协议。正因为HTTP是小字辈，因此body内容的类型是从邮件标准抄的，形式上用/划分大小类别。历史上邮件发展要早得多，发送附件的需求也更迫切。

重定向3XX至少有5个值，广泛接受的是301和302。

* 301: 永久重定向，会影响爬虫，浏览器书签的行为，将域名改为新地址，节省下次访问时间
* 302: 暂时重定向，暗示会恢复，可用于临时性关闭服务

Range头可以跳过并只传输一部分，但前提是服务器首先要在响应里用Accept-Range:
Byte 表示支持。一旦开启会用206表示Range响应。

语义规定在一个连接上前一个请求没完成后面的请求不会被处理，所以有了多连接，最早的RFC规定只有2个连接，但浏览器都不遵守，后来RFC只好从事实去掉了连接上限。

## HTTPS代理

直连的HTTPS肯定是全部加密，但如果中间要经过代理，代理就没法转发了，有两种模式

1. CONNECT报文

客户端发现目标网址是HTTPS且要经过代理，就会先发送CONNECT请求，并带上host和port，当对端连接上后，返回HTTP/1.1 200 Connection Established，注意不是200 OK。紧接着，代理端会尝试去连目的端，成功后代理就会建立HTTP隧道，这个隧道中流转着代理将收到的请求消息原模原样发往目的端的数据。代理除了知道目标地址外，不会获取其它内容。

2. SSL之SNI

利用TLS/SSL握手的第一个Client Hello报文中的扩展地址SNI (Server Name Indication)来获取。这种模式不会出现CONNECT请求，隐蔽性更好。