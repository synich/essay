# 业务分离和厘清概念

所有服务端的程序，都离不开3A(Authentication Authorization and Accounting)。
其中又以前两个最容易混淆。一般把鉴权称为A1，授权称为A2。在Apache中的简称则是authN和authZ。
我们的程序在校验权限时，一般是长连接，所以A1交给登陆认证模块，
后续不再考虑，加上没有计费，所以只有A2。校验权限的回调接口是这样的：

    bool cbCheckAuth(const char*, void*, char*);

第1个入参是请求的方法名，第2个入参是对应的参数，第3个出参是对应的权限名称。
返回值为true表示找到权限，而false表示不关心，采用默认策略。
这时有个新需求，某些敏感操作比如重置系统即使用admin登陆，还需要再次确认用户身份。
显然现有的接口无法满足需求，我本来想通过返回false，并且用第3个参数表示错误码的形式来做，
但是这个想法不被认同。于是仔细查了3A的概念，既然身份确认属于A1，
放在A2的阶段确实不合适。有了理论依据接下来就简单了，在检查A2前增加一个A1的检查函数。

平时做很多业务，都没有把业务划细。虽然平时经常说分层，但对于怎么分层并没有标准，
我的理解就是只要能把业务里的每个概念、差异点给明确了，把不相同的概念隔离开，
层次自然就出来了。否则只能是拍脑袋凭感觉，是无法让其他人信服的。