# 大华设备协议兼容策略说明

大华设备在发展的过程中，产生了二代和三代两套协议。
三代协议使用前期由于缺乏管控，同样功能的三代协议会有不同的表现形式，
(比如摄像头属性的配置)。且在不同产品线间使用也不一致。
另外同样功能也存在三代协议和二代协议的冗余，
曾经试图不再使用二代协议，但从市场接受度和技术角度两方面看，
这种作法既不可行，也没有必要。
但是存在多套协议的混乱局面，必须要明确协议与业务功能的对应关系，
本文档定义两套协议的适用场景、及如何选择的原则。

## 二、三代协议的使用总原则

先来简单看看两套协议的特性：

* 二代协议：所有设备都支持，但协议为二进制，Web无法使用
* 三代协议：协议扩展性好，支撑业务迅速

综上协议总原则：SDK的基础业务使用二代协议，扩展业务则使用三代协议。
Web全部使用三代协议。

## 登陆协议

* SDK -- 0xA0
* Web -- global.login

登陆协议作为使用设备的第一步，基础性不言而喻。
由于二代和三代协议有各自的登陆协议，
但是一台设备显然只需要一种登陆协议就够了，
综合考虑设备使用面、协议扩展性，NetSDK使用二代协议作为设备的登陆协议。
设备保留三代登陆协议给Web使用。

## 音视频类协议

作为一个监控厂商，视频是基础功能。音视频部分包含流的获取、
音视频参数设置、语音对讲等功能。

### 媒体流协议

* SDK -- 0xF4
* Web -- RTSP(前端)/0xF4(存储)

视频流协议有三种，其中二代支持静态多连接和动态多连接两种，
同时三代协议也有部分产品线在使用。
从协议使用的覆盖面和演进方向综合评估，
NetSDK使用二代的动态多连接协议，即0xF4作为未来的支持重点。
使用登陆返回的版本号是否为6，来区分设备是否支持动态多连接。

### 摄像头属性(SDK/Web使用相同协议)

* 如果产品定义包含CameraAttribute，则使用VideoInXX配置族
* 如果产品定义不包含，则使用VideoInOptions/VideoInPreviewOptions配置

### 通道标题

* SDK -- 0xA8
* Web -- VideoIn/ChannelTitle

## 存储类协议

设备通常都带有一定的存储介质，比如相机的SD卡或者存储类设备带硬盘，
这部分涉及的协议，主要包括管理这些介质，或者查找存储介质上的录像/图片。
其中尤其以查找录像/图片最为重要。磁盘管理对于运维平台来说，也有很大的价值。

### 录像查询

* SDK -- 0xF6 or 0xA5
* Web -- MediaFileFind.xxx

SDK通过0xA4查询设备的返回，如果xxx，则支持0xF6，否则使用0xA5。

## 外设功能

### 云台控制
* SDK -- 0x12(基础)+0xF6/Json(扩展)
* Web -- Json Over HTTP

### 事件上报

* SDK -- 0x68/0x69+0xF6
* Web -- 如何保持长连接？

## 网络功能

包括有线、无线网卡的管理

## 用户管理

* SDK -- 0xA6
* Web -- UserManager.xxx
