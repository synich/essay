# 数仓到集市层的同步

最近做doris的预研，比较同步ES的区别，总结下来主要有3种模式

## insert

最简单的模式，应用场景是不变的流水数据，每种数据库都支持，区别在于分区键有没有限制。比如doris要求必须用datetime类型切日表，但hive源表没有相应的类型，为此还要改造数仓表。

## upsert

通过相同的主键实现覆盖，速度相比insert往往会慢一些，ES的upsert速度大约是insert的1/3

## AB表切换

是一种思想，哪怕DB原生不支持也能通过手动模拟，简单做法就是推送完成后，向另一个flag表写入标记。ES原生支持alias操作，使AB切换更便捷。
