# SQLite的全文检索

`CREATE VIRTUAL TABLE memo USING fts5(col1, col2 UNINDEX, tokenize = 'porter ascii');`fts5是module名，被创建的虚表用USING来继承一个已经实现的module，这个virtual table就有了fts5这个module的全文检索能力。

全文检索最核心的要素是分词器，即tokenize的值，不指定默认simple，不过至少要用icu才能处理中文。这种方式创建出的表，如果用.schema去看，会对应另外3到5张普通的table，3张是fts3和fts4共有，加了content、segdir、segments后缀的表。fts4则多两张start和docsize表，称之为Shadow Table。可惜中文分词必须引入ICU，这个库在windows并不具备，不实用。

全文检索表可以用like，但享受不到速度优势，更多是用专为fts设计的match，语法规定match前面必须是表名，默认检索全部列，如果要检索指定列，用`tbl_name match 'col1:key1 col2:key2'`语法。fts5用倒排索引构建`full-text index`，支持prefix match，只能写`keyword*`，不能用在前面。

1. match 'abc*' 搜索abc开头的分词，但不能搜索12abcd(因为不是独立的词)
2. match 'ab* + cd*' 搜索ab开头后面跟cd开头的词
3. neargroup: match NEAR(ab cd) 注意NEAR必须大写，ab和cd顺序随意，只要中间间隔词数量少于默认10，如果想更长，match 'NEAR("a b", 20)'
4. 支持 AND OR NOT，用"a b"指定a和b严格排序

使用pragma table_info和table_xinfo，发现fts表会多出额外两列，rowid列和rank列。rank使用bm25算法。
