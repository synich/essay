# 设计角度看Iceberg和MySQL的联系

最近使用Apache Iceberg组件，思考SQL执行过程的组件分离，发现竟然和MySQL有异曲同工之妙。

Iceberg的引入使我意识到原来SQL的执行分为3个层次

* 计算：SQL语句的解析和物理执行计划生成
* 表管理：涉及事务和锁等复杂功能时的文件管理
* 存储：基础文件的格式设计

Iceberg对应的是表管理，提供了MVCC、快照等底层API（如commit/snapshot）和Table读写高级API（如append/overwrite）能力。业务代码通常写append逻辑，二者间的处理和转换会在spark的iceberg connector中进行封装。

## 和MySQL的联系

理解了这种分层思想后，突然想到MySQL的存储引擎（Storage Engine）可替换也是类似逻辑，区别在于MySQL的定位和其所处的时代，关注的是OLTP行为，存储也以单机为主，所以将表管理和存储作为整体进行设计。

Iceberg面对的往往是OLAP引擎，大都是批量写（写表），所以隐藏了commit层的接口。而MySQL是OLTP引擎，行写入和事务是刚需，所以Storage Engine层和计算层交互的API同时包含insert/update/delete行操作和commit/rollback事务接口。
