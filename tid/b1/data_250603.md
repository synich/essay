# 数仓时间的双轨制

设计一张doris的流水表分区键，由于分区键必须使用DATETIME类型，开始想当然的把这个DATETIME既当作分区键又用作业务时间，但最后发现还是要用两个字段来表示时间。

假设过车表只用一个datetime的话，在出海场景存在如下问题

问题：冬令时那天，一天中的0点~1点会出现两次（时钟回拨），而datetime是通过"2025-06-04 18:15:00"这样的字符串表示法转换得来，而字符串无法表示两个看起来一样，但实际不同的时间

解决办法

1. 再增加一个bigint类型字段，和原始cap_time一样，代表utc时间戳
2. 查询方使用时，特别是涉及精确的业务时间，还是用bigint类型的字段。datetime用处是定位分区加快检索，只要精确到天即可
3. 沿着2继续推导，既然回到2个字段共同使用场景，往datetime写时，只要到"20250604"，不需要精确到秒。转换采用本地时间，和hive保持一致

问题根因：在通常的认识里，时间是永远向前的，这是时间的内生属性。但考虑到时间的外部表示时，夏令时制的存在会使得“时间倒流”。而字符串表示法无法处理夏令时的时间重叠场景。要对应永远向前的时间，只有用int。但是int又不能作为分区。所以只能两个字段一起用

其实有一种办法可以解决，就是datetime中记录的"2025-06-03 16:00:00.999"代表0时区时间（即内生属性的外部表示），不对应钟表时间。这个时间对应的北京时间是2025-06-04 24:00:00.999。但是这样存储，很违反直觉，一定会有人弄错。除非查询方坚持这么存，可以用1个字段

就算datetime记录0时区，还有个小难点，这种方式每天都是24个小时，但是在夏令时国家，业务方统计一天的数量，对应的是钟表时间，而钟表时间并不是永远24小时，也可能是25或23小时。如果采用0时区，计算和转换的成本很高
