# 做更有交互的页面-第二次飞跃

距离上一次用SPA方式重写博客已过去5、6年，前端技术有些长进，初步有个sep.js库封装了常用功能。借助它写了一个更有动态性的血缘展示页面。上次还是在服务端硬凑出了前端页面，这次虽然没用主流技术，但思想还是有了，代码也优雅得多。

## 前端实现

总的思路：hxdom+子元素动态添加+父元素事件捕获+MutationObserver

由于我的技术栈偏后端，所以看了htmx后把它的核心功能引入了sep.js，不执着于后端返回json对象并由前端渲染，而是由后端直接返回完整的DOM片段，恰好web后端整合了pongo2模板库可以使用，两者结合得非常好。

返回的DOM片段后需要动态地添加到父对象中，借助于现代DOM的完善的API，也封装进了sep.js，开始踩了坑每次整体替换效率很低，后来学会了向头或尾添加子对象。

父事件捕获属于知识盲区，以前以为要给每个点击对象绑定事件，学会了父事件后非常简洁地只需要实现一次点击响应函数就能完成点击功能。

## 后端实现

总的思路：路由配置(转发/函数)+pongo2模板+lua/py协同

先是克服了对nginx和容器云的恐惧，把URL转发规则搞明白，然后又借助algernon的反代和内部转发两种方式，实现了静态文件转发和CGI功能处理。

对于模板函数，最早学PHP的时候是比较抗拒的，觉得语法太特殊。但为配合htmx加上for/in语法确实可以极大减少代码编写，思路转变后用起来很顺畅。

lua毕竟功能太少，但借助调用外部py脚本，并约定json作为交互格式后，通过引入单文件的json.lua也算勉强实现了交互，而且省去了py端写http的代码，不失为一个好办法。
