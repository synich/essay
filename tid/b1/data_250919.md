# SQL不同引擎的udf对null处理

不同引擎的udf对于null的容忍度是不同的，而且哪怕相同引擎，在不同的字句处理也会不同

从设计哲学来看，hive最严，spark宽松，sqlite最松

## 静态处理null

以trim/length这两个非常常用函数来看，在spark sql或sqlite执行单条`select trim(null)`或`select length(null)`都没问题，返回null。但在hive会报错，无法执行。因为hive的函数不接受显示传null值。静态null会做编译期检查

## 动态处理null

但是当udf用在hive的select字句或where子句，读取的列为null值（动态null）会有特殊的容错机制。这时trim函数仍然抛异常，但是select udf(col)会接住异常并按null，保证数据能处理完。而where更是天然要处理3值逻辑，自动将udf异常转为null（等效于false），遇到异常继续执行，类似shell错误继续执行。

之所以会出现不一致行为，是因为在SQL中null太过于常见，虽然hive想对null严格对待，但面对大批量数据时还是要特殊处理，将异常转换为null值，保证SQL能执行完成。
